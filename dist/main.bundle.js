!function(e){function t(e){delete installedChunks[e]}function r(e){var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.src=m.p+""+e+"."+g+".hot-update.js",t.appendChild(r)}function n(e){return e=e||1e4,new Promise(function(t,r){if("undefined"==typeof XMLHttpRequest)return r(new Error("No browser support"));try{var n=new XMLHttpRequest,i=m.p+""+g+".hot-update.json";n.open("GET",i,!0),n.timeout=e,n.send(null)}catch(e){return r(e)}n.onreadystatechange=function(){if(4===n.readyState)if(0===n.status)r(new Error("Manifest request to "+i+" timed out."));else if(404===n.status)t();else if(200!==n.status&&304!==n.status)r(new Error("Manifest request to "+i+" failed."));else{try{var e=JSON.parse(n.responseText)}catch(e){return void r(e)}t(e)}}})}function i(e){var t=A[e];if(!t)return m;var r=function(r){return t.hot.active?(A[r]?A[r].parents.indexOf(e)<0&&A[r].parents.push(e):(D=[e],h=r),t.children.indexOf(r)<0&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),D=[]),m(r)};for(var n in m)Object.prototype.hasOwnProperty.call(m,n)&&"e"!==n&&Object.defineProperty(r,n,function(e){return{configurable:!0,enumerable:!0,get:function(){return m[e]},set:function(t){m[e]=t}}}(n));return r.e=function(e){function t(){k--,"prepare"===M&&(I[e]||l(e),0===k&&0===L&&u())}return"ready"===M&&a("prepare"),k++,m.e(e).then(t,function(e){throw t(),e})},r}function o(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:h!==e,active:!0,accept:function(e,r){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._acceptedDependencies[e[n]]=r||function(){};else t._acceptedDependencies[e]=r||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._declinedDependencies[e[r]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);r>=0&&t._disposeHandlers.splice(r,1)},check:c,apply:f,status:function(e){if(!e)return M;R.push(e)},addStatusHandler:function(e){R.push(e)},removeStatusHandler:function(e){var t=R.indexOf(e);t>=0&&R.splice(t,1)},data:w[e]};return h=void 0,t}function a(e){M=e;for(var t=0;t<R.length;t++)R[t].call(null,e)}function d(e){return+e+""===e?+e:e}function c(e){if("idle"!==M)throw new Error("check() is only allowed in idle status");return y=e,a("check"),n(T).then(function(e){if(!e)return a("idle"),null;S={},I={},N=e.c,E=e.h,a("prepare");var t=new Promise(function(e,t){v={resolve:e,reject:t}});_={};return l(0),"prepare"===M&&0===k&&0===L&&u(),t})}function s(e,t){if(N[e]&&S[e]){S[e]=!1;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(_[r]=t[r]);0==--L&&0===k&&u()}}function l(e){N[e]?(S[e]=!0,L++,r(e)):I[e]=!0}function u(){a("ready");var e=v;if(v=null,e)if(y)Promise.resolve().then(function(){return f(y)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var r in _)Object.prototype.hasOwnProperty.call(_,r)&&t.push(d(r));e.resolve(t)}}function f(r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.indexOf(n)<0&&e.push(n)}}if("ready"!==M)throw new Error("apply() is only allowed in ready status");r=r||{};var i,o,c,s,l,u={},f=[],p={},h=function(){console.warn("[HMR] unexpected require("+y.moduleId+") to disposed module")};for(var v in _)if(Object.prototype.hasOwnProperty.call(_,v)){l=d(v);var y;y=_[v]?function(e){for(var t=[e],r={},i=t.slice().map(function(e){return{chain:[e],id:e}});i.length>0;){var o=i.pop(),a=o.id,d=o.chain;if((s=A[a])&&!s.hot._selfAccepted){if(s.hot._selfDeclined)return{type:"self-declined",chain:d,moduleId:a};if(s.hot._main)return{type:"unaccepted",chain:d,moduleId:a};for(var c=0;c<s.parents.length;c++){var l=s.parents[c],u=A[l];if(u){if(u.hot._declinedDependencies[a])return{type:"declined",chain:d.concat([l]),moduleId:a,parentId:l};t.indexOf(l)>=0||(u.hot._acceptedDependencies[a]?(r[l]||(r[l]=[]),n(r[l],[a])):(delete r[l],t.push(l),i.push({chain:d.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:r}}(l):{type:"disposed",moduleId:v};var T=!1,O=!1,R=!1,L="";switch(y.chain&&(L="\nUpdate propagation: "+y.chain.join(" -> ")),y.type){case"self-declined":r.onDeclined&&r.onDeclined(y),r.ignoreDeclined||(T=new Error("Aborted because of self decline: "+y.moduleId+L));break;case"declined":r.onDeclined&&r.onDeclined(y),r.ignoreDeclined||(T=new Error("Aborted because of declined dependency: "+y.moduleId+" in "+y.parentId+L));break;case"unaccepted":r.onUnaccepted&&r.onUnaccepted(y),r.ignoreUnaccepted||(T=new Error("Aborted because "+l+" is not accepted"+L));break;case"accepted":r.onAccepted&&r.onAccepted(y),O=!0;break;case"disposed":r.onDisposed&&r.onDisposed(y),R=!0;break;default:throw new Error("Unexception type "+y.type)}if(T)return a("abort"),Promise.reject(T);if(O){p[l]=_[l],n(f,y.outdatedModules);for(l in y.outdatedDependencies)Object.prototype.hasOwnProperty.call(y.outdatedDependencies,l)&&(u[l]||(u[l]=[]),n(u[l],y.outdatedDependencies[l]))}R&&(n(f,[y.moduleId]),p[l]=h)}var k=[];for(o=0;o<f.length;o++)l=f[o],A[l]&&A[l].hot._selfAccepted&&k.push({module:l,errorHandler:A[l].hot._selfAccepted});a("dispose"),Object.keys(N).forEach(function(e){!1===N[e]&&t(e)});for(var I,S=f.slice();S.length>0;)if(l=S.pop(),s=A[l]){var b={},C=s.hot._disposeHandlers;for(c=0;c<C.length;c++)(i=C[c])(b);for(w[l]=b,s.hot.active=!1,delete A[l],delete u[l],c=0;c<s.children.length;c++){var H=A[s.children[c]];H&&((I=H.parents.indexOf(l))>=0&&H.parents.splice(I,1))}}var x,G;for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(s=A[l]))for(G=u[l],c=0;c<G.length;c++)x=G[c],(I=s.children.indexOf(x))>=0&&s.children.splice(I,1);a("apply"),g=E;for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(e[l]=p[l]);var X=null;for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(s=A[l])){G=u[l];var j=[];for(o=0;o<G.length;o++)if(x=G[o],i=s.hot._acceptedDependencies[x]){if(j.indexOf(i)>=0)continue;j.push(i)}for(o=0;o<j.length;o++){i=j[o];try{i(G)}catch(e){r.onErrored&&r.onErrored({type:"accept-errored",moduleId:l,dependencyId:G[o],error:e}),r.ignoreErrored||X||(X=e)}}}for(o=0;o<k.length;o++){var q=k[o];l=q.module,D=[l];try{m(l)}catch(e){if("function"==typeof q.errorHandler)try{q.errorHandler(e)}catch(t){r.onErrored&&r.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:t,orginalError:e,originalError:e}),r.ignoreErrored||X||(X=t),X||(X=e)}else r.onErrored&&r.onErrored({type:"self-accept-errored",moduleId:l,error:e}),r.ignoreErrored||X||(X=e)}}return X?(a("fail"),Promise.reject(X)):(a("idle"),new Promise(function(e){e(f)}))}function m(t){if(A[t])return A[t].exports;var r=A[t]={i:t,l:!1,exports:{},hot:o(t),parents:(O=D,D=[],O),children:[]};return e[t].call(r.exports,r,r.exports,i(t)),r.l=!0,r.exports}var p=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){s(e,t),p&&p(e,t)};var h,v,_,E,y=!0,g="4ddcc9873c56ab227967",T=1e4,w={},D=[],O=[],R=[],M="idle",L=0,k=0,I={},S={},N={},A={};m.m=e,m.c=A,m.d=function(e,t,r){m.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},m.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return m.d(t,"a",t),t},m.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},m.p="",m.h=function(){return g},i(1)(m.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(t.defaultData=[{id:0,parentId:null,author:"Nick",text:"Nick first comment",rating:3,date:"Thu Oct 26 2017 00:35:31 GMT+0300 (RTZ 2 (зима))"},{id:1,parentId:null,author:"Rick",text:"Rick first comment",rating:22,date:"Thu Oct 12 2017 00:35:31 GMT+0300 (RTZ 2 (зима))"},{id:2,parentId:0,author:"Jane",text:"Jane comment",rating:12,date:"Thu Oct 26 2017 00:12:31 GMT+0300 (RTZ 2 (зима))"},{id:3,parentId:2,author:"Nick",text:"Nick comment",rating:-3,date:"Thu Oct 24 2017 00:35:31 GMT+0300 (RTZ 2 (зима))"},{id:4,parentId:0,author:"Tom",text:"Tom comment",rating:1,date:"Thu Oct 26 2017 00:35:32 GMT+0300 (RTZ 2 (зима))"},{id:5,parentId:1,author:"Jane",text:"Jane comment",rating:0,date:"Thu Oct 25 2017 00:35:31 GMT+0300 (RTZ 2 (зима))"}],t.MIN_INPUT_LENGTH=3),i=t.MAX_INPUT_LENGTH=20,o=t.MIN_TEXTAREA_LENGTH=10,a=t.MAX_TEXTAREA_LENGTH=150;t.ADD_COMMENT_ERROR_TIME=3,t.ERRORS={SHORT_NAME:"минимальная длина имени: "+n+" символа",LONG_NAME:"максимальная длина имени: "+i+" символов",SHORT_TEXT:"минимальная длина текста: "+o+" символов",LONG_TEXT:"максимальная длина текста: "+a+" символов",BAD_NAME:"недопустимые символы в имени"},t.VIEW_MODS={DATE:"date",RATING:"rating",TREE:"tree"},t.AUTHOR_REGEX=/[^a-zA-Zа-яА-Я]+/g,t.TEXTAREA_REGEX=/\n/g,t.COMMENT_REGEX=/<br>/g},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=r(2),o=(n(i),r(0)),a=r(3),d=n(a),c=document.querySelector("#comments"),s=document.querySelector("#addComment"),l=document.querySelector("#clearStorage"),u=new d.default(c,o.defaultData);s.addEventListener("click",u.addCommentToEnd),l.addEventListener("click",function(){window.localStorage.clear(),console.log("localStorage cleaned! ➥"),location.reload()})},function(e,t){},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),a=window.localStorage,d=function(){function e(t,r){n(this,e),this._originData=JSON.parse(a.getItem("data"))||r,a.getItem("data")||a.setItem("data",JSON.stringify(this._originData)),this._dateReverse=!1,this._ratingReverse=!1,this._dom=t,this.transformDOM(),this.initTree()}return i(e,[{key:"initTree",value:function(){var t=this;switch(this._viewType||(this._viewType=o.VIEW_MODS.TREE),this._data=[],this._originData.forEach(function(e){var r={};for(var n in e)r[n]=e[n];t._data.push(r)}),this._replyCommentId=null,this._dom.querySelector(".comment-list").innerHTML="",this._viewType){case o.VIEW_MODS.TREE:this._data=e.transformToTreeData(this._data);break;case o.VIEW_MODS.RATING:this._data.sort(function(e,r){return t._ratingReverse?e.rating<r.rating:e.rating>r.rating});break;case o.VIEW_MODS.DATE:this._data.sort(function(e,r){return t._dateReverse?new Date(e.date)<new Date(r.date):new Date(e.date)>new Date(r.date)})}this._data.forEach(function(e){return t.addComment(e)})}},{key:"transformDOM",value:function(){var e=this,t=document.createElement("div"),r=document.createElement("ul"),n=document.createElement("div"),i=document.createElement("div");t.className="comment-list",r.className="comment-sort",n.className="comment-add-form",i.className="add-from",this._addCForm={},this._sort={},this._dom.appendChild(this._sort.view=r),this._dom.appendChild(this._cList=t),this._dom.appendChild(this._addCForm.view=n),i.innerHTML='<div class="add-from__author"><input type="text"></div><div class="add-from__text"><textarea></textarea></div><div class="add-from__error"></div><div class="add-from__add">Добавить</div>',this._addCForm.view.appendChild(i),this._addCForm.addBtn=i.querySelector(".add-from__add"),this._addCForm.error=i.querySelector(".add-from__error"),this._addCForm.textarea=i.querySelector(".add-from__text textarea"),this._addCForm.author=i.querySelector(".add-from__author input"),this._addCForm.addBtn.addEventListener("click",function(){e.addCommentToEnd.apply(e,arguments)}),r.innerHTML='<li class="comment-sort__item">Сортировать: </li><li class="comment-sort__item"><a id="sortDate" href="#">по дате</a></li><li class="comment-sort__item"><a id="sortRating" href="#">по рейтингу</a></li><li class="comment-sort__item"><a id="treeMode" href="#">в виде дерева</a></li>',this._sort.dateSort=r.querySelector("#sortDate"),this._sort.rateSort=r.querySelector("#sortRating"),this._sort.treeMode=r.querySelector("#treeMode"),this._sort.dateSort.addEventListener("click",function(t){e.sortComments(t,o.VIEW_MODS.DATE)}),this._sort.rateSort.addEventListener("click",function(t){e.sortComments(t,o.VIEW_MODS.RATING)}),this._sort.treeMode.addEventListener("click",function(t){e.sortComments(t,o.VIEW_MODS.TREE)})}},{key:"addComment",value:function(e){var t=this,r=document.createElement("div");r.className="comment",r.id=e.id;var n=new Date(e.date);n="<b>"+(n.getDate()+1)+"."+(n.getMonth()+1)+"."+n.getFullYear()+"</b> ("+n.getHours()+":"+n.getMinutes()+")",r.innerHTML='<div class="comment__author">'+e.author+':</div><div class="comment__date">'+n+'</div><div class="comment__text">'+e.text+'</div><div class="comment__controls"><div class="comment__reply">reply</div><div class="comment__edit">edit</div><div class="comment__remove">remove</div></div><div class="comment__info"><div class="comment__down">-</div><div class="comment__rating">'+e.rating+'</div><div class="comment__up">+</div></div>',r.style.marginLeft=50*e._level+"px",e.view={block:r,editBtn:r.querySelector(".comment__edit"),removeBtn:r.querySelector(".comment__remove"),replyBtn:r.querySelector(".comment__reply"),rating:r.querySelector(".comment__rating"),ratingDown:r.querySelector(".comment__down"),ratingUp:r.querySelector(".comment__up"),text:r.querySelector(".comment__text")},e.editListener=function(){return t.editComment.apply(t,arguments)},e.removeListener=function(){return t.removeCommentHandler.apply(t,arguments)},e.replyListener=function(){return t.replyComment.apply(t,arguments)},e.ratingDownListener=function(){return t.ratingDown.apply(t,arguments)},e.ratingUpListener=function(){return t.ratingUp.apply(t,arguments)},e.view.editBtn.addEventListener("click",e.editListener),e.view.removeBtn.addEventListener("click",e.removeListener),e.view.replyBtn.addEventListener("click",e.replyListener),e.view.ratingDown.addEventListener("click",e.ratingDownListener),e.view.ratingUp.addEventListener("click",e.ratingUpListener),this._cList.appendChild(r)}},{key:"addCommentToEnd",value:function(){var e=this._addCForm,t=e.textarea,r=e.author;if(this.hideError(),r.value.length<o.MIN_INPUT_LENGTH&&this.viewError(o.ERRORS.SHORT_NAME),r.value.length>o.MAX_INPUT_LENGTH&&this.viewError(o.ERRORS.LONG_NAME),t.value.length<o.MIN_TEXTAREA_LENGTH&&this.viewError(o.ERRORS.SHORT_TEXT),t.value.length>o.MAX_TEXTAREA_LENGTH&&this.viewError(o.ERRORS.LONG_TEXT),o.AUTHOR_REGEX.test(r.value)&&this.viewError(o.ERRORS.BAD_NAME),!this._errorView){this.hideError();var n=this._originData.map(function(e){return e.id}).sort(function(e,t){return e>t}),i=n.length?n[n.length-1]:1;console.log("lastId ➥",i),this._originData.push({id:i+1,parentId:this._replyCommentId||null,author:r.value,text:t.value=t.value.replace(o.TEXTAREA_REGEX,"<br/>"),rating:0,date:new Date}),a.setItem("data",JSON.stringify(this._originData)),r.value="",t.value="",this.initTree()}}},{key:"viewError",value:function(e){var t=this._addCForm.error;this._errorView=!0,t.innerHTML||(t.innerHTML="Ошибка: "),t.innerHTML+="<br />"+e}},{key:"hideError",value:function(){var e=this._addCForm.error;this._errorView=!1,e.innerHTML=""}},{key:"editComment",value:function(e){var t=this.findComment(e);t.editStatus=!t.editStatus;var r=t.view,n=r.editBtn,i=r.block,d=r.text,c=void 0;if(n.innerHTML=t.editStatus?"save":"edit",t.editStatus)c=document.createElement("textarea"),c.value=t.text.replace(o.COMMENT_REGEX,"\n");else{d.value.length<o.MIN_TEXTAREA_LENGTH&&(d.value="Ок. Это пустой комментарий"),t.text=d.value.substr(0,o.MAX_TEXTAREA_LENGTH),c=document.createElement("div");var s=t.text.replace(o.TEXTAREA_REGEX,"<br>");s=s.substr(0,o.MAX_TEXTAREA_LENGTH),c.innerHTML=s,this._originData.forEach(function(e){e.id===t.id&&(e.text=s)})}c.className="comment__text",i.removeChild(t.view.text),i.insertBefore(c,i.children[1]),t.view.text=c,a.setItem("data",JSON.stringify(this._originData))}},{key:"removeCommentHandler",value:function(e){this.removeComment(this.findComment(e))}},{key:"removeComment",value:function(e){var t=e.view,r=t.editBtn,n=t.removeBtn,i=t.replyBtn,o=t.ratingDown,d=t.ratingUp,c=t.block;r.removeEventListener("click",e.editListener),n.removeEventListener("click",e.removeListener),i.removeEventListener("click",e.replyListener),o.removeEventListener("click",e.ratingDownListener),d.removeEventListener("click",e.ratingUpListener),this._cList.removeChild(c),this._data=this._data.filter(function(t){return t!==e}),this._originData=this._data.filter(function(t){return t.id!==e.id}),a.setItem("data",JSON.stringify(this._originData))}},{key:"removeComments",value:function(){var e=this;this._data.forEach(function(t){return e.removeComment(t)})}},{key:"replyComment",value:function(e){var t=this.findComment(e);this._replyCommentId=t.id}},{key:"findComment",value:function(e){var t=e.path.filter(function(e){return"comment"===e.className})[0];return this._data.filter(function(e){return e.view.block===t})[0]}},{key:"ratingUp",value:function(t){var r=this.findComment(t);e.removeRatingCtrl(r,"up"),this._originData.find(function(e){return e.id===r.id}).rating+=1,a.setItem("data",JSON.stringify(this._originData)),this.initTree()}},{key:"ratingDown",value:function(t){var r=this.findComment(t);e.removeRatingCtrl(r,"down"),this._originData.find(function(e){return e.id===r.id}).rating-=1,a.setItem("data",JSON.stringify(this._originData)),this.initTree()}},{key:"sortComments",value:function(e,t){switch(e.preventDefault(),t){case o.VIEW_MODS.DATE:this._dateReverse=!this._dateReverse;break;case o.VIEW_MODS.RATING:this._ratingReverse=!this._ratingReverse}this._viewType=t,this.initTree()}}],[{key:"transformToTreeData",value:function(t){return e.rollDownData(e.setLevels(e.rollUpData(t)))}},{key:"rollUpData",value:function(e){return e.forEach(function(t){if(t.children&&(t.children=null),null!==t.parentId){var r=e.filter(function(e){return e.id===t.parentId})[0];r.children||(r.children=[]),r.children.push(t)}}),e=e.filter(function(e){return null===e.parentId})}},{key:"setLevels",value:function(e){return function e(t,r){t.forEach(function(t){t._level=r,t.children&&t.children.length&&e(t.children,r+1)})}(e,0),e}},{key:"rollDownData",value:function(e){var t=[];return function e(r){r.forEach(function(r){t.push(r),r.children&&r.children.length&&e(r.children)})}(e),t}},{key:"removeRatingCtrl",value:function(e,t){var r=e.view,n=r.ratingUp,i=r.ratingDown,o=r.rating;e._raited=!0,"up"===t?e.rating++:e.rating--,o.innerHTML=e.rating,n.remove(),i.remove()}}]),e}();t.default=d}]);