!function(e){function t(e){delete installedChunks[e]}function n(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=p.p+""+e+"."+E+".hot-update.js",t.appendChild(n)}function r(e){return e=e||1e4,new Promise(function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,i=p.p+""+E+".hot-update.json";r.open("GET",i,!0),r.timeout=e,r.send(null)}catch(e){return n(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+i+" timed out."));else if(404===r.status)t();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+i+" failed."));else{try{var e=JSON.parse(r.responseText)}catch(e){return void n(e)}t(e)}}})}function i(e){var t=I[e];if(!t)return p;var n=function(n){return t.hot.active?(I[n]?I[n].parents.indexOf(e)<0&&I[n].parents.push(e):(D=[e],v=n),t.children.indexOf(n)<0&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),D=[]),p(n)};for(var r in p)Object.prototype.hasOwnProperty.call(p,r)&&"e"!==r&&Object.defineProperty(n,r,function(e){return{configurable:!0,enumerable:!0,get:function(){return p[e]},set:function(t){p[e]=t}}}(r));return n.e=function(e){function t(){C--,"prepare"===b&&(O[e]||s(e),0===C&&0===T&&u())}return"ready"===b&&a("prepare"),C++,p.e(e).then(t,function(e){throw t(),e})},n}function o(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:v!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:c,apply:f,status:function(e){if(!e)return b;x.push(e)},addStatusHandler:function(e){x.push(e)},removeStatusHandler:function(e){var t=x.indexOf(e);t>=0&&x.splice(t,1)},data:k[e]};return v=void 0,t}function a(e){b=e;for(var t=0;t<x.length;t++)x[t].call(null,e)}function d(e){return+e+""===e?+e:e}function c(e){if("idle"!==b)throw new Error("check() is only allowed in idle status");return g=e,a("check"),r(w).then(function(e){if(!e)return a("idle"),null;H={},O={},M=e.c,y=e.h,a("prepare");var t=new Promise(function(e,t){h={resolve:e,reject:t}});_={};return s(0),"prepare"===b&&0===C&&0===T&&u(),t})}function l(e,t){if(M[e]&&H[e]){H[e]=!1;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(_[n]=t[n]);0==--T&&0===C&&u()}}function s(e){M[e]?(H[e]=!0,T++,n(e)):O[e]=!0}function u(){a("ready");var e=h;if(h=null,e)if(g)Promise.resolve().then(function(){return f(g)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in _)Object.prototype.hasOwnProperty.call(_,n)&&t.push(d(n));e.resolve(t)}}function f(n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];e.indexOf(r)<0&&e.push(r)}}if("ready"!==b)throw new Error("apply() is only allowed in ready status");n=n||{};var i,o,c,l,s,u={},f=[],m={},v=function(){console.warn("[HMR] unexpected require("+g.moduleId+") to disposed module")};for(var h in _)if(Object.prototype.hasOwnProperty.call(_,h)){s=d(h);var g;g=_[h]?function(e){for(var t=[e],n={},i=t.slice().map(function(e){return{chain:[e],id:e}});i.length>0;){var o=i.pop(),a=o.id,d=o.chain;if((l=I[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:d,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:d,moduleId:a};for(var c=0;c<l.parents.length;c++){var s=l.parents[c],u=I[s];if(u){if(u.hot._declinedDependencies[a])return{type:"declined",chain:d.concat([s]),moduleId:a,parentId:s};t.indexOf(s)>=0||(u.hot._acceptedDependencies[a]?(n[s]||(n[s]=[]),r(n[s],[a])):(delete n[s],t.push(s),i.push({chain:d.concat([s]),id:s})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}(s):{type:"disposed",moduleId:h};var w=!1,L=!1,x=!1,T="";switch(g.chain&&(T="\nUpdate propagation: "+g.chain.join(" -> ")),g.type){case"self-declined":n.onDeclined&&n.onDeclined(g),n.ignoreDeclined||(w=new Error("Aborted because of self decline: "+g.moduleId+T));break;case"declined":n.onDeclined&&n.onDeclined(g),n.ignoreDeclined||(w=new Error("Aborted because of declined dependency: "+g.moduleId+" in "+g.parentId+T));break;case"unaccepted":n.onUnaccepted&&n.onUnaccepted(g),n.ignoreUnaccepted||(w=new Error("Aborted because "+s+" is not accepted"+T));break;case"accepted":n.onAccepted&&n.onAccepted(g),L=!0;break;case"disposed":n.onDisposed&&n.onDisposed(g),x=!0;break;default:throw new Error("Unexception type "+g.type)}if(w)return a("abort"),Promise.reject(w);if(L){m[s]=_[s],r(f,g.outdatedModules);for(s in g.outdatedDependencies)Object.prototype.hasOwnProperty.call(g.outdatedDependencies,s)&&(u[s]||(u[s]=[]),r(u[s],g.outdatedDependencies[s]))}x&&(r(f,[g.moduleId]),m[s]=v)}var C=[];for(o=0;o<f.length;o++)s=f[o],I[s]&&I[s].hot._selfAccepted&&C.push({module:s,errorHandler:I[s].hot._selfAccepted});a("dispose"),Object.keys(M).forEach(function(e){!1===M[e]&&t(e)});for(var O,H=f.slice();H.length>0;)if(s=H.pop(),l=I[s]){var N={},j=l.hot._disposeHandlers;for(c=0;c<j.length;c++)(i=j[c])(N);for(k[s]=N,l.hot.active=!1,delete I[s],delete u[s],c=0;c<l.children.length;c++){var A=I[l.children[c]];A&&((O=A.parents.indexOf(s))>=0&&A.parents.splice(O,1))}}var P,S;for(s in u)if(Object.prototype.hasOwnProperty.call(u,s)&&(l=I[s]))for(S=u[s],c=0;c<S.length;c++)P=S[c],(O=l.children.indexOf(P))>=0&&l.children.splice(O,1);a("apply"),E=y;for(s in m)Object.prototype.hasOwnProperty.call(m,s)&&(e[s]=m[s]);var U=null;for(s in u)if(Object.prototype.hasOwnProperty.call(u,s)&&(l=I[s])){S=u[s];var q=[];for(o=0;o<S.length;o++)if(P=S[o],i=l.hot._acceptedDependencies[P]){if(q.indexOf(i)>=0)continue;q.push(i)}for(o=0;o<q.length;o++){i=q[o];try{i(S)}catch(e){n.onErrored&&n.onErrored({type:"accept-errored",moduleId:s,dependencyId:S[o],error:e}),n.ignoreErrored||U||(U=e)}}}for(o=0;o<C.length;o++){var R=C[o];s=R.module,D=[s];try{p(s)}catch(e){if("function"==typeof R.errorHandler)try{R.errorHandler(e)}catch(t){n.onErrored&&n.onErrored({type:"self-accept-error-handler-errored",moduleId:s,error:t,orginalError:e,originalError:e}),n.ignoreErrored||U||(U=t),U||(U=e)}else n.onErrored&&n.onErrored({type:"self-accept-errored",moduleId:s,error:e}),n.ignoreErrored||U||(U=e)}}return U?(a("fail"),Promise.reject(U)):(a("idle"),new Promise(function(e){e(f)}))}function p(t){if(I[t])return I[t].exports;var n=I[t]={i:t,l:!1,exports:{},hot:o(t),parents:(L=D,D=[],L),children:[]};return e[t].call(n.exports,n,n.exports,i(t)),n.l=!0,n.exports}var m=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){l(e,t),m&&m(e,t)};var v,h,_,y,g=!0,E="2b2d0948ec9072457ba3",w=1e4,k={},D=[],L=[],x=[],b="idle",T=0,C=0,O={},H={},M={},I={};p.m=e,p.c=I,p.d=function(e,t,n){p.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},p.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(t,"a",t),t},p.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p.p="",p.h=function(){return E},i(1)(p.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.defaultData=[{id:0,parentId:null,author:"Nick",text:"Nick first comment",rating:3},{id:1,parentId:null,author:"Rick",text:"Rick first comment",rating:22},{id:2,parentId:0,author:"Jane",text:"Jane comment",rating:12},{id:3,parentId:2,author:"Nick",text:"Nick comment",rating:-3},{id:4,parentId:0,author:"Tom",text:"Tom comment",rating:1},{id:5,parentId:1,author:"Jane",text:"Jane comment",rating:0}],t.MIN_INPUT_LENGTH=3,t.MAX_INPUT_LENGTH=20,t.MIN_TEXTAREA_LENGTH=10,t.MAX_TEXTAREA_LENGTH=150,t.ADD_COMMENT_ERROR_TIME=3},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(2),o=(r(i),n(0)),a=n(3),d=r(a),c=document.querySelector("#comments"),l=document.querySelector("#addComment"),s=new d.default(c,o.defaultData);l.addEventListener("click",s.addCommentToEnd)},function(e,t){},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),a=function(){function e(t,n){r(this,e),this._data=n,this._dom=t,this.transformDOM(),this.initTree()}return i(e,[{key:"initTree",value:function(){var t=this;this._dom.querySelector(".comment-list").innerHTML="",this._data=e.transformData(this._data),this._data.forEach(function(e){return t.addComment(e)})}},{key:"transformDOM",value:function(){var e=this,t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");t.className="comment-list",n.className="comment-add-form",r.className="add-from",this._addCForm={},this._dom.appendChild(this._cList=t),this._dom.appendChild(this._addCForm.view=n),r.innerHTML='<div class="add-from__author"><input type="text"></div><div class="add-from__text"><textarea></textarea></div><div class="add-from__error"></div><div class="add-from__add">Добавить</div>',this._addCForm.view.appendChild(r),this._addCForm.addBtn=r.querySelector(".add-from__add"),this._addCForm.error=r.querySelector(".add-from__error"),this._addCForm.textarea=r.querySelector(".add-from__text textarea"),this._addCForm.author=r.querySelector(".add-from__author input"),this._addCForm.addBtn.addEventListener("click",function(){e.addCommentToEnd.apply(e,arguments)})}},{key:"addComment",value:function(e){var t=this,n=document.createElement("div");n.className="comment",n.id=e.id,n.innerHTML='<div class="comment__author">'+e.author+':</div><div class="comment__text">'+e.text+'</div><div class="comment__controls"><div class="comment__reply">reply</div><div class="comment__edit">edit</div><div class="comment__remove">remove</div></div><div class="comment__info"><div class="comment__down">-</div><div class="comment__rating">'+e.rating+'</div><div class="comment__up">+</div></div>',n.style.marginLeft=50*e._level+"px",e.view={block:n,editBtn:n.querySelector(".comment__edit"),removeBtn:n.querySelector(".comment__remove"),replyBtn:n.querySelector(".comment__reply"),rating:n.querySelector(".comment__rating"),ratingDown:n.querySelector(".comment__down"),ratingUp:n.querySelector(".comment__up"),text:n.querySelector(".comment__text")},e.editListener=function(){return t.editComment.apply(t,arguments)},e.removeListener=function(){return t.removeCommentHandler.apply(t,arguments)},e.replyListener=function(){return t.replyComment.apply(t,arguments)},e.ratingDownListener=function(){return t.ratingDown.apply(t,arguments)},e.ratingUpListener=function(){return t.ratingUp.apply(t,arguments)},e.view.editBtn.addEventListener("click",e.editListener),e.view.removeBtn.addEventListener("click",e.removeListener),e.view.replyBtn.addEventListener("click",e.replyListener),e.view.ratingDown.addEventListener("click",e.ratingDownListener),e.view.ratingUp.addEventListener("click",e.ratingUpListener),this._cList.appendChild(n)}},{key:"addCommentToEnd",value:function(){var e=this._addCForm,t=e.error,n=e.textarea,r=e.author;r.value.length<=o.MIN_INPUT_LENGTH||r.value.length>=o.MAX_INPUT_LENGTH||n.value.length<=o.MIN_TEXTAREA_LENGTH||n.value.length>=o.MAX_TEXTAREA_LENGTH?(t.innerHTML="Ошибка",setTimeout(function(){return t.innerHTML=""},1e3*o.ADD_COMMENT_ERROR_TIME)):(t.innerHTML="",this._data.push({id:22,parentId:3,author:r.value,text:n.value,rating:0}),this.initTree())}},{key:"editComment",value:function(e){var t=this.findComment(e);t.editStatus=!t.editStatus;var n=t.view,r=n.editBtn,i=n.block,o=n.text,a=void 0;r.innerHTML=t.editStatus?"save":"edit",t.editStatus?(a=document.createElement("textarea"),a.value=t.text):(t.text=o.value,a=document.createElement("div"),a.innerHTML=t.text),a.className="comment__text",i.removeChild(t.view.text),i.insertBefore(a,i.children[1]),t.view.text=a}},{key:"removeCommentHandler",value:function(e){this.removeComment(this.findComment(e))}},{key:"removeComment",value:function(e){var t=e.view,n=t.editBtn,r=t.removeBtn,i=t.replyBtn,o=t.ratingDown,a=t.ratingUp,d=t.block;n.removeEventListener("click",e.editListener),r.removeEventListener("click",e.removeListener),i.removeEventListener("click",e.replyListener),o.removeEventListener("click",e.ratingDownListener),a.removeEventListener("click",e.ratingUpListener),this._dom.removeChild(d),this._data=this._data.filter(function(t){return t!==e})}},{key:"removeComments",value:function(){var e=this;this._data.forEach(function(t){return e.removeComment(t)})}},{key:"replyComment",value:function(e){console.log(this.findComment(e))}},{key:"findComment",value:function(e){var t=e.path.filter(function(e){return"comment"===e.className})[0];return this._data.filter(function(e){return e.view.block===t})[0]}},{key:"ratingUp",value:function(t){var n=this.findComment(t);e.removeRatingCtrl(n,"up")}},{key:"ratingDown",value:function(t){var n=this.findComment(t);e.removeRatingCtrl(n,"down")}}],[{key:"transformData",value:function(t){return e.rollDownData(e.setLevels(e.rollUpData(t)))}},{key:"rollUpData",value:function(e){return e.forEach(function(t){if(t.children&&(t.children=null),null!==t.parentId){var n=e.filter(function(e){return e.id===t.parentId})[0];n.children||(n.children=[]),n.children.push(t)}}),e=e.filter(function(e){return null===e.parentId})}},{key:"setLevels",value:function(e){return function e(t,n){t.forEach(function(t){t._level=n,t.children&&t.children.length&&e(t.children,n+1)})}(e,0),e}},{key:"rollDownData",value:function(e){var t=[];return function e(n){n.forEach(function(n){t.push(n),n.children&&n.children.length&&e(n.children)})}(e),t}},{key:"removeRatingCtrl",value:function(e,t){var n=e.view,r=n.ratingUp,i=n.ratingDown,o=n.rating;e._raited=!0,"up"===t?e.rating++:e.rating--,o.innerHTML=e.rating,r.remove(),i.remove()}}]),e}();t.default=a}]);